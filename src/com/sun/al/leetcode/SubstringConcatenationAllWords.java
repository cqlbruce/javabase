package sun.al.leetcode;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class SubstringConcatenationAllWords {


    public static void main(String[] args) {

        SubstringConcatenationAllWords sca = new SubstringConcatenationAllWords();
//        s = "barfoothefoobarman",
//        words = ["foo","bar"]
        //"barfoofoobarthefoobarman"
        //      ["bar","foo","the"]
        String s = "abababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababababab";
        String[] words = {"ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba","ab","ba"};
//        System.out.println(s.indexOf("foo"));

//        List<Integer> list = sca.findSubstringMyTwo(s , words);
//        System.out.println(list);

        List<String> list = new ArrayList<>();
        sca.permutation(words , 0 , words.length-1 , list);
        System.out.println(list.size());
    }




    /** 数组中从索引begin到索引end之间的子数组参与到全排列 */
    public void permutation(String[] strs, int begin, int end , List<String> list ) {

        if (begin == end) { //只剩最后一个字符时为出口
            StringBuffer sf = new StringBuffer();
            System.out.println("-----------" + list.size()+"--------------------------");

            for (int i = 0; i < strs.length; ++i) {
//                System.out.print(strs[i]);
                sf.append(strs[i]);
            }
            list.add(sf.toString());
//            System.out.println();
        } else {
            for (int i = begin; i <= end; ++i) { //每个字符依次固定到数组或子数组的第一个
                if (canSwap(strs, begin, i)) { //去重
                    swap(strs, begin, i); //交换
                    permutation(strs, begin + 1, end , list); //递归求子数组的全排列
                    swap(strs, begin, i); //还原
                }
            }
        }
    }

    void swap(String[] strs, int from, int to) {
        String temp = strs[from];
        strs[from] = strs[to];
        strs[to] = temp;
    }

    boolean canSwap(String[] strs, int begin, int end) {
        for (int i = begin; i < end; ++i) {
            if (strs[i] == strs[end]) {
                return false;
            }
        }
        return true;
    }


    public List<Integer> findSubstringMyTwo(String s, String[] words) {

//        for ()
        String str = words[0];

        List<Integer> resList = new ArrayList<>();
        int k = 0 ;
        int aLength = words[0].length()*words.length;
        int strLength = words[0].length();
        while (k!=-1){
            k = s.indexOf(str , k);
            if (k%strLength==0){
                int startIndex = 0 ;
                if (k>aLength){
                    startIndex = k - aLength;
                }

                while(startIndex<=k&&(startIndex+aLength)<=s.length()){
                    boolean flag = true;
                    String[] wordss = new String[words.length];
                    System.arraycopy(words,0,wordss,0,words.length);
                    for (int i = 0 ; i<words.length ; i++){
                        String ss = s.substring(startIndex+strLength*(1+i),startIndex+strLength*(i+1)+strLength) ;
                        int t = contains(ss , wordss);
                        if (t!=-1){
                            wordss[t] = "";
                        }
                        if (t==-1){
                            flag = false;
                            break;
                        }
                    }
                    if (flag){
                        resList.add(startIndex);
                    }
                    startIndex = startIndex + strLength;
                }

            }
            if (k!=-1){
                k=k+1;
            }
         }

        return resList ;
    }

    public int contains(String s , String[] words){

        for (int i = 0 ; i< words.length ; i++){
            if (!"".equals(words[i])&&s.equals(words[i])){
                return i ;
            }
        }

        return -1 ;
    }


    public List<Integer> findSubstringMyone(String s, String[] words) {

        List<Integer> list = new ArrayList<>();
        if ("".equals(s) || null == s || words == null || words.length == 0){
            return list;
        }
        int strLength = words[0].length();
        int tLength = strLength*words.length;
        if (s.length()<tLength){
            return list;
        }

        // 1 、轮询所有数组内情况,找到第一个单词在s中的位置
        int flag = 0 ;
        for(int i=0 ; i<words.length ; i++){
            String ss = s ;
            flag = 0 ;
            while (true){
                //只要能匹配上第一个单词
                int k = ss.indexOf(words[i]);
                if (k==-1){
                    break;
                }

                //直接截出对应长度
                if (ss.length()<k+tLength)
                    break;
                String sss = ss.substring(k+strLength , k+tLength);
                String[] wordss = new String[words.length];
                System.arraycopy(words,0,wordss , 0 , words.length);
                wordss[i] = "";

                if (match(sss , wordss)){
                    if (!list.contains(flag+k)){
                        list.add(flag+k);
                    }
                }

                flag = flag + k +  1;
                    //截断匹配后的
                ss = ss.substring(k+1);



                if (ss.length()<tLength){
                    break;
                }

            }
        }

        return list ;
    }

    public boolean match(String s, String[] words){

        if (s.equals("")){
            for (int i=0 ; i<words.length ; i++){
                if (!words[i].equals("")){
                    return false;
                }
            }
            return true;
        }

        for (int i=0 ; i<words.length ; i++) {
            if (words[i].equals("")){
                continue;
            }
            int length = words[i].length();
            if (s.length()<length)
                return false;
            if (s.startsWith(words[i])){
                words[i]="";
                return match(s.substring(length) , words);
            }
        }
        return false;
    }

}
